#!/usr/bin/env python3
import argparse
import os


def exist(file_name):
    return os.path.exists(file_name)


def isDir(file_name):
    return os.path.isdir(file_name)


def isFile(file_name):
    return os.path.isfile(file_name)


def isSymlink(file_name):
    return os.path.islink(file_name)


def copyFile(SRC, DEST, dest_path=None):
    # Source section:
    src_path = os.path.realpath(SRC)
    src_info = os.stat(src_path)
    src_fd = os.open(src_path, os.O_RDONLY)
    src_content = os.read(src_fd, src_info.st_size)
    # Destination section:
    if dest_path == None:
        dest_path = os.path.realpath(DEST)
    else:
        dest_path = os.path.join(dest_path, DEST)
    dest_fd = os.open(dest_path, os.O_CREAT | os.O_WRONLY)
    # Write content from Source to Destination:
    os.write(dest_fd, src_content)
    # Change access time, modified time and mode of Destination = Source:
    os.utime(dest_fd, (src_info.st_atime, src_info.st_mtime))
    os.chmod(dest_fd, src_info.st_mode)
    # Close all:
    os.close(src_fd)
    os.close(dest_fd)


def updateFile(SRC, DEST, dest_path=None):
    pass
def copyFile():
    pass
def copyLink():
    pass
def copyAllFiles():
    pass

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='This is a python version of rsync.')
    parser.add_argument('SRC')
    parser.add_argument('DEST')
    args = parser.parse_args()

    if exist(args.SRC) and not exist(args.DEST):
        if isFile(args.SRC):
            copyFile()
        elif isDir(args.SRC):
            copyFile()
        elif isSymlink(args.SRC):
            copyLink()
    elif exist(args.SRC) and exist(args.DEST):
        if isFile(args.SRC):
            if isFile(args.DEST):
                updateFile()
            elif isDir(args.DEST):
                copyFile()
            elif isSymlink(args.DEST):
                raise IOError('Unable sync file to a symlink.')
        if isDir(args.SRC):
            if isFile(args.DEST):
                raise IOError('Unable sync directory to a file.')
            elif isDir(args.DEST):
                if args.SRC[-1] == '/':
                    copyAllFilesInDir()
                else:
                    copyFolder()
            elif isSymlink(args.DEST):
                raise IOError('Unable sync directory to a symlink.')
        if isSymlink(args.SRC):
            if isFile(args.DEST):
                raise IOError('Unable sync symlink to a file.')
            elif isDir(args.DEST):
                copyLink()
            elif isSymlink(args.DEST):
                raise IOError('Unable sync symlink to a symlink.')



    # if exist(args.SRC):
    #     if isFile(args.SRC):
    #         pass
    #     elif isDir(args.SRC):
    #         pass
    #     elif isSymlink(args.SRC):
    #         pass
    # else:
    #     print('Source: No such filed or directory.')
    #
    # if exist(args.DEST):
    #     if isFile(args.DEST):
    #         pass
    #     elif isDir(args.DEST):
    #         copyFile(args.SRC, args.SRC, args.DEST)
    # else:
    #     copyFile(args.SRC, args.DEST)
